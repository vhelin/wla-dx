#
# WLA DX Windows build script for CMake + MSVC
#

trigger:
- master

pool:
  vmImage: 'windows-latest'

strategy:
  matrix:
    Debug_Build:
      config: 'Debug'
    Release_Build:
      config: 'Release'

steps:
# 1. Build the specific configuration
- script: |
    cmake . -B build
    cmake --build build --config $(config) -j
  displayName: 'Build $(config)'

# 2. Run tests using ONLY the binaries from that build
- bash: |
    # Add the specific binary folder created by WLA DX's CMakeLists + MSVC
    # It follows the pattern: build/binaries/[Configuration]
    export PATH=$PWD/build/binaries/$(config):$PATH
    
    # Debugging: List the files to be 100% sure they are there
    echo "Checking for binaries in: $PWD/build/binaries/$(config)"
    ls -l $PWD/build/binaries/$(config)
    
    # Run the test script
    ./run_tests.sh
  displayName: 'Run Tests ($(config))'
  workingDirectory: '$(Build.SourcesDirectory)'
